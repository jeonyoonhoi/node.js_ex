{"version":3,"sources":["../src/utils.js"],"names":["fs","require","spawn","debug","exit","status","messages","forEach","console","log","message","process","checkInternetConnection","Promise","resolve","lookup","err","code","checkExecutionPolicy","reject","output","child","error","stdout","on","data","toString","push","stderr","linesHit","filter","line","includes","unrestricted","length","stdin","end","isPathAccessible","filePath","accessSync","module","exports"],"mappings":";;AAAA,IAAMA,KAAKC,QAAQ,IAAR,CAAX;;eACkBA,QAAQ,eAAR,C;IAAVC,K,YAAAA,K;;AAER;;;AACA,IAAMC,QAAQF,QAAQ,SAAR,CAAd;;AAEA;;;;;;;AAOA,SAASG,IAAT,CAAeC,MAAf,EAAoC;AAAA,oCAAVC,QAAU;AAAVA,YAAU;AAAA;;AAClC,MAAIA,QAAJ,EAAc;AACZA,aAASC,OAAT,CAAiB;AAAA,aAAWC,QAAQC,GAAR,CAAYC,OAAZ,CAAX;AAAA,KAAjB;AACD;;AAEDC,UAAQP,IAAR,CAAaC,MAAb;AACD;;AAED;;;;;AAKA,SAASO,uBAAT,GAAoC;AAClC,SAAO,IAAIC,OAAJ,CAAY,UAACC,OAAD,EAAa;AAC9Bb,YAAQ,KAAR,EAAec,MAAf,CAAsB,eAAtB,EAAuC,UAACC,GAAD,EAAS;AAC9C,UAAIA,OAAOA,IAAIC,IAAJ,KAAa,WAAxB,EAAqC;AACnCH,gBAAQ,KAAR;AACD,OAFD,MAEO;AACLA,gBAAQ,IAAR;AACD;AACF,KAND;AAOD,GARM,CAAP;AASD;;AAED;;;;;AAKA,SAASI,oBAAT,GAAiC;AAC/B,SAAO,IAAIL,OAAJ,CAAY,UAACC,OAAD,EAAUK,MAAV,EAAqB;AACtC,QAAIC,SAAS,EAAb;AACA,QAAIC,cAAJ;;AAEA,QAAI;AACFlB,YAAM,kDAAN;AACAkB,cAAQnB,MAAM,gBAAN,EAAwB,CAAC,YAAD,EAAe,SAAf,EAA0B,qBAA1B,CAAxB,CAAR;AACD,KAHD,CAGE,OAAOoB,KAAP,EAAc;AACdnB,YAAM,8CAAN;AACAgB,aAAOG,KAAP;AACD;;AAEDD,UAAME,MAAN,CAAaC,EAAb,CAAgB,MAAhB,EAAwB,UAACC,IAAD,EAAU;AAChCtB,YAAM,kCAAkCsB,KAAKC,QAAL,EAAxC;AACAN,aAAOO,IAAP,CAAYF,KAAKC,QAAL,EAAZ;AACD,KAHD;;AAKAL,UAAMO,MAAN,CAAaJ,EAAb,CAAgB,MAAhB,EAAwB,UAACC,IAAD,EAAU;AAChCtB,YAAM,kCAAkCsB,KAAKC,QAAL,EAAxC;AACAN,aAAOO,IAAP,CAAYF,KAAKC,QAAL,EAAZ;AACD,KAHD;;AAKAL,UAAMG,EAAN,CAAS,MAAT,EAAiB,YAAM;AACrB,UAAMK,WAAWT,OAAOU,MAAP,CAAc,UAACC,IAAD;AAAA,eAAUA,KAAKC,QAAL,CAAc,cAAd,KAAiCD,KAAKC,QAAL,CAAc,cAAd,CAAjC,IAAkED,KAAKC,QAAL,CAAc,QAAd,CAA5E;AAAA,OAAd,CAAjB;AACA,UAAMC,eAAgBJ,SAASK,MAAT,GAAkB,CAAxC;;AAEA,UAAI,CAACD,YAAL,EAAmB;AACjB9B,cAAM,0CAAN;AACAW,gBAAQ,KAAR;AACD,OAHD,MAGO;AACLX,cAAM,2CAAN;AACAW,gBAAQ,IAAR;AACD;AACF,KAXD;;AAaAO,UAAMc,KAAN,CAAYC,GAAZ;AACD,GApCM,CAAP;AAqCD;;AAED;;;;;;AAMA,SAASC,gBAAT,CAA2BC,QAA3B,EAAqC;AACnC,MAAI;AACFtC,OAAGuC,UAAH,CAAcD,QAAd;AACAnC,0CAAoCmC,QAApC;AACA,WAAO,IAAP;AACD,GAJD,CAIE,OAAOtB,GAAP,EAAY;AACZb,0CAAoCmC,QAApC;AACA,WAAO,KAAP;AACD;AACF;;AAEDE,OAAOC,OAAP,GAAiB;AACf7B,kDADe;AAEfM,4CAFe;AAGfd,YAHe;AAIfiC;AAJe,CAAjB","file":"utils.js","sourcesContent":["const fs = require('fs')\nconst { spawn } = require('child_process')\n\n// Internal Modules\nconst debug = require('./debug')\n\n/**\n * Exits the process with a given status,\n * logging a given message before exiting.\n *\n * @param {number} status - exit status\n * @param {string} messages - message to log\n */\nfunction exit (status, ...messages) {\n  if (messages) {\n    messages.forEach(message => console.log(message))\n  }\n\n  process.exit(status)\n}\n\n/**\n * Checks for an active Internet connection by doing a DNS lookup of Microsoft.com.\n *\n * @return {Promise.<boolean>} - True if lookup succeeded (or if we skip the test)\n */\nfunction checkInternetConnection () {\n  return new Promise((resolve) => {\n    require('dns').lookup('microsoft.com', (err) => {\n      if (err && err.code === 'ENOTFOUND') {\n        resolve(false)\n      } else {\n        resolve(true)\n      }\n    })\n  })\n}\n\n/**\n * Checks the current Windows PS1 execution policy. The upgrader requires an unrestricted policy.\n *\n * @return {Promise.<boolean>} - True if unrestricted, false if it isn't\n */\nfunction checkExecutionPolicy () {\n  return new Promise((resolve, reject) => {\n    let output = []\n    let child\n\n    try {\n      debug('Powershell: Attempting to spawn PowerShell child')\n      child = spawn('powershell.exe', ['-NoProfile', '-NoLogo', 'Get-ExecutionPolicy'])\n    } catch (error) {\n      debug('Powershell: Could not spawn PowerShell child')\n      reject(error)\n    }\n\n    child.stdout.on('data', (data) => {\n      debug('PowerShell: Stdout received: ' + data.toString())\n      output.push(data.toString())\n    })\n\n    child.stderr.on('data', (data) => {\n      debug('PowerShell: Stderr received: ' + data.toString())\n      output.push(data.toString())\n    })\n\n    child.on('exit', () => {\n      const linesHit = output.filter((line) => line.includes('Unrestricted') || line.includes('RemoteSigned') || line.includes('Bypass'))\n      const unrestricted = (linesHit.length > 0)\n\n      if (!unrestricted) {\n        debug('PowerShell: Resolving restricted (false)')\n        resolve(false)\n      } else {\n        debug('PowerShell: Resolving unrestricted (true)')\n        resolve(true)\n      }\n    })\n\n    child.stdin.end()\n  })\n}\n\n/**\n * Checks if a path exists\n *\n * @param filePath - file path to check\n * @returns {boolean} - does the file path exist?\n */\nfunction isPathAccessible (filePath) {\n  try {\n    fs.accessSync(filePath)\n    debug(`Utils: isPathAccessible(): ${filePath} exists`)\n    return true\n  } catch (err) {\n    debug(`Utils: isPathAccessible(): ${filePath} does not exist`)\n    return false\n  }\n}\n\nmodule.exports = {\n  checkInternetConnection,\n  checkExecutionPolicy,\n  exit,\n  isPathAccessible\n}\n"]}